# Railway Deployment Guide for Qadim

## ðŸš‚ Deploy to Railway

Railway is perfect for Qadim because it provides:
- **Managed PostgreSQL** with pgvector extension
- **Redis** for caching and queues
- **Automatic deployments** from GitHub
- **Environment variable management**
- **Custom domains** and SSL

## Quick Deploy

### Option 1: One-Click Deploy

[![Deploy on Railway](https://railway.app/button.svg)](https://railway.app/template/your-template-id)

### Option 2: Manual Setup

1. **Connect GitHub Repository**
   ```bash
   # Push your code to GitHub first
   git add .
   git commit -m "Initial Qadim setup"
   git push origin main
   ```

2. **Create Railway Project**
   - Go to [railway.app](https://railway.app)
   - Click "New Project" â†’ "Deploy from GitHub repo"
   - Select your Qadim repository

3. **Add Services**
   - **PostgreSQL**: Add PostgreSQL service (Railway will auto-configure pgvector)
   - **Redis**: Add Redis service
   - **Web Service**: Your Next.js app (auto-detected)

4. **Configure Environment Variables**
   ```env
   # Database (auto-generated by Railway)
   DATABASE_URL=${{Postgres.DATABASE_URL}}
   
   # Redis (auto-generated by Railway)
   REDIS_URL=${{Redis.REDIS_URL}}
   
   # NextAuth
   NEXTAUTH_SECRET=your-super-secret-key-here
   NEXTAUTH_URL=https://your-app.railway.app
   
   # Google OAuth
   GOOGLE_CLIENT_ID=your-google-client-id
   GOOGLE_CLIENT_SECRET=your-google-client-secret
   
   # OpenAI
   OPENAI_API_KEY=your-openai-api-key
   
   # S3 Storage (use Railway's built-in or external)
   S3_ENDPOINT=https://your-storage-endpoint
   S3_ACCESS_KEY_ID=your-access-key
   S3_SECRET_ACCESS_KEY=your-secret-key
   S3_BUCKET_NAME=qadim-documents
   
   # Feature Flags
   FEATURE_DEBATE_MODE=true
   FEATURE_TIMELINE_MODE=true
   FEATURE_COMMUNITY_NOTES=true
   FEATURE_ADS=false
   
   # App Config
   APP_ENV=production
   NODE_ENV=production
   ```

## Database Setup

Railway PostgreSQL comes with pgvector pre-installed! Just run:

```bash
# Connect to Railway CLI (optional)
railway login
railway link

# Run migrations and seed
railway run npm run db:push
railway run npm run db:seed
```

Or use Railway's web console:
1. Go to your PostgreSQL service
2. Open "Query" tab
3. Run: `CREATE EXTENSION IF NOT EXISTS vector;`

## Environment Variables Reference

| Variable | Description | Railway Template |
|----------|-------------|------------------|
| `DATABASE_URL` | PostgreSQL connection | `${{Postgres.DATABASE_URL}}` |
| `REDIS_URL` | Redis connection | `${{Redis.REDIS_URL}}` |
| `NEXTAUTH_URL` | Your app URL | `https://your-app.railway.app` |
| `GOOGLE_CLIENT_ID` | Google OAuth client ID | Your value |
| `GOOGLE_CLIENT_SECRET` | Google OAuth secret | Your value |
| `OPENAI_API_KEY` | OpenAI API key | Your value |

## Custom Domain Setup

1. **Add Custom Domain**
   - Go to your Railway project
   - Click "Settings" â†’ "Domains"
   - Add your domain (e.g., `qadim.com`)

2. **Update Environment Variables**
   ```env
   NEXTAUTH_URL=https://qadim.com
   ```

3. **Configure DNS**
   - Add CNAME record pointing to your Railway domain
   - Railway automatically handles SSL certificates

## Monitoring & Logs

Railway provides built-in monitoring:
- **Metrics**: CPU, memory, network usage
- **Logs**: Real-time application logs
- **Health Checks**: Automatic health monitoring
- **Alerts**: Email/Slack notifications for downtime

## Scaling

Railway automatically scales based on traffic:
- **Horizontal scaling**: Multiple instances
- **Vertical scaling**: More CPU/memory per instance
- **Zero-downtime deployments**: Rolling updates

## Cost Optimization

Railway pricing is usage-based:
- **Hobby Plan**: $5/month for small projects
- **Pro Plan**: $20/month for production apps
- **Enterprise**: Custom pricing for large deployments

## Troubleshooting

### Common Issues

1. **Build Failures**
   ```bash
   # Check build logs in Railway dashboard
   # Ensure all environment variables are set
   ```

2. **Database Connection Issues**
   ```bash
   # Verify DATABASE_URL is correctly set
   # Check if pgvector extension is enabled
   ```

3. **Redis Connection Issues**
   ```bash
   # Verify REDIS_URL is correctly set
   # Check Redis service is running
   ```

### Debug Commands

```bash
# Connect to Railway CLI
railway login
railway link

# View logs
railway logs

# Run commands in Railway environment
railway run npm run db:seed
railway run npx prisma studio

# SSH into service (if enabled)
railway shell
```

## Production Checklist

- [ ] Set strong `NEXTAUTH_SECRET`
- [ ] Configure Google OAuth with production URLs
- [ ] Set up OpenAI API key with usage limits
- [ ] Enable database backups
- [ ] Configure monitoring alerts
- [ ] Set up custom domain
- [ ] Test all features in production
- [ ] Configure CDN for static assets (optional)

## Support

- **Railway Docs**: [docs.railway.app](https://docs.railway.app)
- **Community**: [Railway Discord](https://discord.gg/railway)
- **Status**: [status.railway.app](https://status.railway.app)

---

**Ready to deploy Qadim to Railway!** ðŸš‚âœ¨
